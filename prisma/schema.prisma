// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum FitBucket {
  NOT_FIT
  P70_PERCENT
  BEST_FIT
}

model User {
  id        String      @id @default(cuid())
  email     String      @unique
  password  String
  name      String
  avatar    String?
  savedJobs SavedJob[]
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("users")
}

model Profile {
  id             String        @id @default(cuid())
  name           String
  title           String
  hourlyRate      String        // e.g., "$65/hr"
  jobSuccess      String        // e.g., "100%"
  experience      String?       // e.g., "6+ Years"
  badge           String?       // e.g., "top-rated", "rising-talent", "expert"
  overview        String?       // Profile description/overview
  skills          String[]      // Array of skills, e.g., ["React", "Node.js", "TypeScript"]
  tags            String[]      // Array of tags, e.g., ["frontend", "fullstack", "remote"]
  portfolios      Portfolio[]
  caseStudies     CaseStudy[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([name])
  @@index([title])
}

model Portfolio {
  id          String   @id @default(cuid())
  profileId  String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  title       String
  description String
  category    String?  // e.g., "Script & Automation", "AI Integration"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([profileId])
  @@index([category])
}

model CaseStudy {
  id          String   @id @default(cuid())
  profileId  String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  title       String
  description String
  category    String?  // e.g., "Script & Automation", "AI Integration"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([profileId])
  @@index([category])
}

model Template {
  id        String   @id @default(cuid())
  name      String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
}

model SavedJob {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId     String   // Store as string to match Job.id (which is Int but converted to string in API)
  createdAt DateTime @default(now())

  @@unique([userId, jobId])
  @@index([userId])
  @@index([jobId])
}

model Job {
  id                 Int       @id @default(autoincrement())
  jobTitle           String
  jobDescription     String
  clientDetailsRaw   String
  skillsRaw          String
  clientCountry      String
  paymentVerified    Boolean
  clientRating       Float
  jobsPosted         Int?
  hireRate           Float?    // 0..1 (55% => 0.55)
  totalSpent         Float?    // USD
  hires              Int?
  activeJobs         Int?
  avgHourlyPaid      Float?
  totalHours         Int?
  memberSince        String?   // keep as string to avoid date parsing issues
  aiMatchPercent     Float?    // 0..1 (optional)
  bucket             FitBucket
  fitScore           Int?       // 0, 70, or 100
  reasonsNotes       String?
  category           String?
  industry           String?
  createdAt          DateTime  @default(now())

  @@index([clientCountry])
  @@index([bucket])
}

model PromptConfig {
  id           String   @id @default(cuid())
  name         String   @default("Default Proposal Prompt")
  systemPrompt String   @db.Text
  temperature  Float    @default(0.7)
  maxTokens    Int      @default(800)
  model        String   @default("openai/gpt-4o-mini")
  updatedAt    DateTime @updatedAt
  createdAt    DateTime @default(now())
}